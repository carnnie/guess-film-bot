# Guess Film Bot - игровой телеграм бот для угадывания фильмов по кадрам

Это Telegram-бот для игры в угадывание фильмов по кадрам из них. Пользователь запускает игру, набрав `/play`, и бот выдает кинокадр. Пользователь должен угадать название фильма за определенное количество попыток. Бот будет давать подсказки после каждого неверного предположения и обновлять счет пользователя после каждой игры. Пользователь может просмотреть свой прогресс, набрав `/stat`.

Когда пользователь правильно угадает название фильма, бот предоставит дополнительную информацию о фильме.

**Команды**:

- `/start` - запустить бота.
- `/help` - правила игры и команды.
- `/play` - начать играть.
- `/surrender` - сдаться и получить информацию о фильме.
- `/cancel` - выход из режима игры.
- `/stat` - просмотреть статистику.

Бот использует базу данных MongoDB для пользовательской информации и результатов игр. Это позволяет боту отслеживать прогресс пользователя с течением времени и обеспечивает долговременное хранение его прогресса.

Также бот использует машину состояний на основании Redis для хранения состояния пользователя. Это позволяет избежать непредвиденных ситуаций при перезапуске бота.

# Зависимости

    Python 3.12
    aiogram 3.0.* - для использования Telegram Bot API
    PyMongo - драйвер для MongoDB
    redis - python-интерфейс для Redis

# Установка

1. Клонирование репозитория:

```bash
git clone https://github.com/carnnie/guess-film-bot
```

2. Заполнить файл `.env.dist` и переименовать его `.env`.

3. Сборка образа и запуск контейнеров при помощи Docker Compose. Бот автоматически запустится и будет готов к работе.

```bash
docker compose up --build -d
```

# Данные

**Данные по фильмам** хранятся в json файле `res/films.json`.

```json
[
  {
    "_id": 0, // Уникальное
    "name": "Форрест Гамп",
    "year": 1994,
    "genre": "Комедия, романтика",
    "description": "Сидя на автобусной остановке, Форрест Гамп — не очень...", // Опциональное
    "image_path": "res/images/1.jpg" // Опциональное
  }
]
```

**Структура MongoDB:**

```js
// Collection - Players
{
  "_id": {
    "$numberLong": "6855231396" // Уникальное (tg user id)
  },
  "current_film": null, // id угадываемого фильма
  "guessed_films": [0, 1], // Отгаданные фильмы
  "attempts": 3, // Текущее количество попыток
  "score": 12 // Очки
}
```
